[tox]
envlist =
    check,
    coverage
skipsdist = True

[flake8]
; We use a line length of 120 instead of pep8's default 79
max-line-length = 120
; Files not checked:
;  - migrations: most of these are autogenerated and don't need a check
;  - manage: these are autogenerated and don't need a check
exclude = *migrations,manage.py
; Cyclomatic complexity check with mccabe.
max-complexity = 20

[testenv]
whitelist_externals =
    /bin/mkdir
deps =
    -r{toxinidir}/deployment/requirements_test.txt
install_command = pip install --pre {opts} {packages}
recreate = True
passenv = *
commands =
    python {toxinidir}/test_project/manage.py test locking

[testenv:check]
deps =
    flake8
    pep8
    pyflakes
    mccabe
    pep8-naming
    flake8-print
    flake8-debugger
commands =
    flake8 locking

[testenv:coverage]
commands =
    coverage run --source='{toxinidir}/locking' {toxinidir}/test_project/manage.py test locking
    coverage report -m
    coverage xml -i -o {toxinidir}/coverage.xml
